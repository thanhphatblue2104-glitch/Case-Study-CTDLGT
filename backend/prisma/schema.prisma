// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init
// prisma/schema.prisma

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

model Product {
  id        Int      @id @default(autoincrement())
  barcode   String   @unique
  name      String
  category  String?
  unit      String?

  batches   Batch[]
  audits    StockAudit[]

  createdAt DateTime @default(now())
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  createdAt DateTime @default(now())
}

model Batch {
  id             Int      @id @default(autoincrement())
  expirationDate DateTime
  quantity       Int
  importDate     DateTime @default(now())

  productId      Int
  product        Product  @relation(fields: [productId], references: [id])

  importDetails  ImportDetail[]
  exportDetails  ExportDetail[]
}

model ImportReceipt {
  id        Int      @id @default(autoincrement())
  supplier  String?
  note      String?
  createdAt DateTime @default(now())

  details   ImportDetail[]
}

model ImportDetail {
  importId Int
  batchId  Int
  quantity Int

  import   ImportReceipt @relation(fields: [importId], references: [id])
  batch    Batch         @relation(fields: [batchId], references: [id])

  @@id([importId, batchId])
}

model ExportReceipt {
  id        Int      @id @default(autoincrement())
  customer  String?
  note      String?
  createdAt DateTime @default(now())

  details   ExportDetail[]
}

model ExportDetail {
  exportId Int
  batchId  Int
  quantity Int

  export   ExportReceipt @relation(fields: [exportId], references: [id])
  batch    Batch         @relation(fields: [batchId], references: [id])

  @@id([exportId, batchId])
}

model StockAudit {
  id             Int      @id @default(autoincrement())
  auditDate      DateTime @default(now())

  systemQuantity Int
  actualQuantity Int
  difference     Int

  note           String?

  productId      Int
  product        Product  @relation(fields: [productId], references: [id])
}
